---

layout: post
title: 学习ebpf
category: 技术
tags: Linux
keywords: ebpf

---

## 简介（未完成）

* TOC
{:toc}

[初识 eBPF，你应该知道的知识](https://mp.weixin.qq.com/s/Gd4kV0hnLE_yBWm_MmMEUQ)简单来说，eBPF 是 Linux 内核中一个非常灵活与高效的类虚拟机（virtual machine-like）组件， 能够在许多内核 hook 点安全地执行字节码（bytecode）。

在内核中运行用户指定的程序被证明是一种有用的设计，eBPF 程序是在内核中被事件触发的。在一些特定的指令被执行时，这些事件会在 hook 处被捕获。Hook 被触发就会执行 eBPF 程序，对数据进行捕获和操作。

![](/public/upload/linux/ebpf_overview.png)


极客时间《ebpf核心技术实战》未读


[基于 eBPF 的 Kubernetes 一站式可观测性系统](https://mp.weixin.qq.com/s/npQg0lOjFVrIpEtu90ycZQ)eBPF 相当于在内核中构建了一个执行引擎，通过内核调用将这段程序 attach 到某个内核事件上，做到监听内核事件；有了事件我们就能进一步做协议推导，筛选出感兴趣的协议，对事件进一步处理后放到 ringbuffer 或者 eBPF 自带的数据结构 Map 中，供用户态进程读取；用户态进程读取这些数据后，进一步关联 Kubernetes 元数据后推送到存储端。这是整体处理过程。

![](/public/upload/linux/ebpf_k8s.png)

eBPF 的超能力体现在能订阅各种内核事件，如文件读写、网络流量等，运行在 Kubernetes 中的容器或者 Pod 里的一切行为都是通过内核系统调用来实现的，内核知道机器上所有进程中发生的所有事情，所以内核几乎是可观测性的最佳观测点，这也是我们为什么选择 eBPF 的原因。另一个在内核上做监测的好处是应用不需要变更，也不需要重新编译内核，做到了真正意义上的无侵入。

[Kubernetes 中的 eBPF](https://mp.weixin.qq.com/s/l3_pFwR_HB2FStO705d1DA) 未读

